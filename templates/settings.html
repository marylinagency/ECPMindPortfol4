{% extends "base.html" %}

{% block title %}Settings - BookGenPro{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <div class="bg-white rounded-xl shadow-lg p-8 fade-in">
        <!-- Header -->
        <div class="flex items-center mb-8">
            <a href="{{ url_for('index') }}" class="text-gray-500 hover:text-gray-700 mr-4">
                <i data-feather="arrow-left" class="w-5 h-5"></i>
            </a>
            <h1 class="text-3xl font-bold text-gray-900">Settings</h1>
        </div>
        
        <!-- API Configuration -->
        <div class="mb-8">
            <h2 class="text-2xl font-semibold text-gray-900 mb-6">API Configuration</h2>
            
            <form method="POST" action="{{ url_for('save_settings') }}" data-validate>
                <div class="space-y-6">
                    <!-- AI Provider Selection -->
                    <div>
                        <label for="ai_provider" class="block text-sm font-medium text-gray-700 mb-2">
                            AI Provider
                        </label>
                        <select id="ai_provider" name="ai_provider" 
                                class="w-full px-3 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                onchange="toggleProviderSettings()">
                            <option value="openrouter" {{ 'selected' if config.ai_provider == 'openrouter' else '' }}>
                                OpenRouter (Multiple AI Models)
                            </option>
                            <option value="gemini" {{ 'selected' if config.ai_provider == 'gemini' else '' }}>
                                Google Gemini (Direct API)
                            </option>
                        </select>
                        <p class="mt-2 text-sm text-gray-600">
                            Choose between OpenRouter (access to many models) or Google Gemini (direct access)
                        </p>
                    </div>

                    <!-- OpenRouter Settings -->
                    <div id="openrouter-settings" style="display: {{ 'block' if config.ai_provider != 'gemini' else 'none' }}">
                        <!-- OpenRouter API Key -->
                        <div>
                        <label for="openrouter_api_key" class="block text-sm font-medium text-gray-700 mb-2">
                            OpenRouter API Key
                            <span class="text-red-500">*</span>
                        </label>
                        <div class="relative">
                            <input type="password" id="openrouter_api_key" name="openrouter_api_key" 
                                   value="{{ config.openrouter_api_key }}"
                                   class="w-full px-3 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent pr-10"
                                   placeholder="Enter your OpenRouter API key">
                            <button type="button" onclick="togglePasswordVisibility('openrouter_api_key')" 
                                    class="absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600">
                                <i data-feather="eye" class="w-5 h-5"></i>
                            </button>
                        </div>
                        <p class="mt-2 text-sm text-gray-600">
                            Get your API key from 
                            <a href="https://openrouter.ai" target="_blank" class="text-blue-600 hover:text-blue-800">OpenRouter.ai</a>
                        </p>
                    </div>
                    
                    <!-- Model Selection -->
                    <div>
                        <label for="model" class="block text-sm font-medium text-gray-700 mb-2">
                            AI Model
                        </label>
                        <select id="model" name="model" 
                                class="w-full px-3 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            
                            <!-- Free Models Section -->
                            <optgroup label="ðŸ†“ Free Models (No Cost)">
                                <option value="meta-llama/llama-3.2-3b-instruct:free" {{ 'selected' if config.selected_model == 'meta-llama/llama-3.2-3b-instruct:free' else '' }}>
                                    Llama 3.2 3B Instruct (Free)
                                </option>
                                <option value="meta-llama/llama-3.2-1b-instruct:free" {{ 'selected' if config.selected_model == 'meta-llama/llama-3.2-1b-instruct:free' else '' }}>
                                    Llama 3.2 1B Instruct (Free)
                                </option>
                                <option value="microsoft/phi-3-mini-128k-instruct:free" {{ 'selected' if config.selected_model == 'microsoft/phi-3-mini-128k-instruct:free' else '' }}>
                                    Phi-3 Mini 128K (Free)
                                </option>
                                <option value="microsoft/phi-3-medium-128k-instruct:free" {{ 'selected' if config.selected_model == 'microsoft/phi-3-medium-128k-instruct:free' else '' }}>
                                    Phi-3 Medium 128K (Free)
                                </option>
                                <option value="huggingface/zephyr-7b-beta:free" {{ 'selected' if config.selected_model == 'huggingface/zephyr-7b-beta:free' else '' }}>
                                    Zephyr 7B Beta (Free)
                                </option>
                                <option value="openchat/openchat-7b:free" {{ 'selected' if config.selected_model == 'openchat/openchat-7b:free' else '' }}>
                                    OpenChat 7B (Free)
                                </option>
                                <option value="openrouter/auto" {{ 'selected' if config.selected_model == 'openrouter/auto' else '' }}>
                                    Auto (OpenRouter Chooses Best Free Model)
                                </option>
                                <option value="nousresearch/nous-capybara-7b:free" {{ 'selected' if config.selected_model == 'nousresearch/nous-capybara-7b:free' else '' }}>
                                    Nous Capybara 7B (Free)
                                </option>
                                <option value="mistralai/mistral-7b-instruct:free" {{ 'selected' if config.selected_model == 'mistralai/mistral-7b-instruct:free' else '' }}>
                                    Mistral 7B Instruct (Free)
                                </option>
                                <option value="google/gemma-7b-it:free" {{ 'selected' if config.selected_model == 'google/gemma-7b-it:free' else '' }}>
                                    Gemma 7B IT (Free)
                                </option>
                                <option value="google/gemma-2b-it:free" {{ 'selected' if config.selected_model == 'google/gemma-2b-it:free' else '' }}>
                                    Gemma 2B IT (Free)
                                </option>
                                <option value="toppy/undi95-toppy-m-7b:free" {{ 'selected' if config.selected_model == 'toppy/undi95-toppy-m-7b:free' else '' }}>
                                    Toppy M 7B (Free)
                                </option>
                                <option value="undi95/remm-slerp-l2-13b:free" {{ 'selected' if config.selected_model == 'undi95/remm-slerp-l2-13b:free' else '' }}>
                                    ReMM SLERP L2 13B (Free)
                                </option>
                                <option value="gryphe/mythomist-7b:free" {{ 'selected' if config.selected_model == 'gryphe/mythomist-7b:free' else '' }}>
                                    Mythomist 7B (Free)
                                </option>
                                <option value="undi95/toppy-m-7b:free" {{ 'selected' if config.selected_model == 'undi95/toppy-m-7b:free' else '' }}>
                                    Toppy M 7B Alt (Free)
                                </option>
                            </optgroup>
                            
                            <!-- Premium Models Section -->
                            <optgroup label="ðŸ’Ž Premium Models (Paid)">
                                <option value="openai/gpt-3.5-turbo" {{ 'selected' if config.selected_model == 'openai/gpt-3.5-turbo' else '' }}>
                                    GPT-3.5 Turbo (Fast & Cost-effective)
                                </option>
                                <option value="openai/gpt-4" {{ 'selected' if config.selected_model == 'openai/gpt-4' else '' }}>
                                    GPT-4 (Higher Quality)
                                </option>
                                <option value="openai/gpt-4-turbo" {{ 'selected' if config.selected_model == 'openai/gpt-4-turbo' else '' }}>
                                    GPT-4 Turbo (Balanced)
                                </option>
                                <option value="openai/gpt-4o" {{ 'selected' if config.selected_model == 'openai/gpt-4o' else '' }}>
                                    GPT-4O (Latest)
                                </option>
                                <option value="anthropic/claude-3-haiku" {{ 'selected' if config.selected_model == 'anthropic/claude-3-haiku' else '' }}>
                                    Claude 3 Haiku (Fast)
                                </option>
                                <option value="anthropic/claude-3-sonnet" {{ 'selected' if config.selected_model == 'anthropic/claude-3-sonnet' else '' }}>
                                    Claude 3 Sonnet (Balanced)
                                </option>
                                <option value="anthropic/claude-3-opus" {{ 'selected' if config.selected_model == 'anthropic/claude-3-opus' else '' }}>
                                    Claude 3 Opus (Highest Quality)
                                </option>
                                <option value="meta-llama/llama-3.1-405b-instruct" {{ 'selected' if config.selected_model == 'meta-llama/llama-3.1-405b-instruct' else '' }}>
                                    Llama 3.1 405B (Largest)
                                </option>
                                <option value="meta-llama/llama-3.1-70b-instruct" {{ 'selected' if config.selected_model == 'meta-llama/llama-3.1-70b-instruct' else '' }}>
                                    Llama 3.1 70B
                                </option>
                                <option value="google/gemini-pro-1.5" {{ 'selected' if config.selected_model == 'google/gemini-pro-1.5' else '' }}>
                                    Gemini Pro 1.5
                                </option>
                            </optgroup>
                        </select>
                        <p class="mt-2 text-sm text-gray-600">
                            Free models are great for testing. Premium models offer better quality and faster responses.
                        </p>
                        <div class="mt-2 p-3 bg-green-50 border border-green-200 rounded-lg">
                            <p class="text-sm text-green-800">
                                <i data-feather="info" class="w-4 h-4 inline mr-1"></i>
                                <strong>Free Models:</strong> No cost, perfect for testing and light usage (rate limited)
                            </p>
                        </div>
                    </div>
                    </div>

                    <!-- Gemini Settings -->
                    <div id="gemini-settings" style="display: {{ 'block' if config.ai_provider == 'gemini' else 'none' }}">
                        <!-- Gemini API Key -->
                        <div>
                            <label for="gemini_api_key" class="block text-sm font-medium text-gray-700 mb-2">
                                Google Gemini API Key
                                <span class="text-red-500">*</span>
                            </label>
                            <div class="relative">
                                <input type="password" id="gemini_api_key" name="gemini_api_key" 
                                       value="{{ config.gemini_api_key }}"
                                       class="w-full px-3 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent pr-10"
                                       placeholder="Enter your Gemini API key">
                                <button type="button" onclick="togglePasswordVisibility('gemini_api_key')" 
                                        class="absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600">
                                    <i data-feather="eye" class="w-5 h-5"></i>
                                </button>
                            </div>
                            <p class="mt-2 text-sm text-gray-600">
                                Get your API key from 
                                <a href="https://makersuite.google.com/app/apikey" target="_blank" class="text-blue-600 hover:text-blue-800">Google AI Studio</a>
                            </p>
                        </div>

                        <!-- Gemini Model Selection -->
                        <div>
                            <label for="gemini_model" class="block text-sm font-medium text-gray-700 mb-2">
                                Gemini Model
                            </label>
                            <select id="gemini_model" name="gemini_model" 
                                    class="w-full px-3 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <option value="gemini-1.5-flash" {{ 'selected' if config.gemini_model == 'gemini-1.5-flash' else '' }}>
                                    Gemini 1.5 Flash (Fast & Efficient)
                                </option>
                                <option value="gemini-1.5-pro" {{ 'selected' if config.gemini_model == 'gemini-1.5-pro' else '' }}>
                                    Gemini 1.5 Pro (Higher Quality)
                                </option>
                                <option value="gemini-pro" {{ 'selected' if config.gemini_model == 'gemini-pro' else '' }}>
                                    Gemini Pro (Standard)
                                </option>
                            </select>
                            <p class="mt-2 text-sm text-gray-600">
                                Gemini 1.5 Flash is recommended for speed and cost efficiency.
                            </p>
                        </div>
                    </div>
                    
                    <div class="flex justify-end">
                        <button type="submit" 
                                class="bg-gradient-to-r from-blue-600 to-purple-600 text-white px-6 py-3 rounded-lg hover:shadow-lg transform hover:scale-105 transition-all duration-200 font-medium">
                            <i data-feather="save" class="w-5 h-5 inline mr-2"></i>
                            Save Settings
                        </button>
                    </div>
                </div>
            </form>
        </div>
        
        <!-- AI Author Bio Enhancement -->
        <div class="border-t border-gray-200 pt-8 mt-8">
            <h2 class="text-2xl font-semibold text-gray-900 mb-6">AI Author Bio Enhancement</h2>
            
            <div class="bg-gradient-to-br from-purple-50 to-blue-50 border border-purple-200 rounded-xl p-6">
                <div class="flex items-start space-x-4 mb-4">
                    <div class="w-10 h-10 bg-gradient-to-br from-purple-500 to-blue-600 rounded-full flex items-center justify-center">
                        <i data-feather="user" class="w-5 h-5 text-white"></i>
                    </div>
                    <div>
                        <h3 class="text-lg font-semibold text-gray-900">Professional Bio Generator</h3>
                        <p class="text-gray-600">Transform basic information into polished, professional author biographies</p>
                    </div>
                </div>
                
                <div class="space-y-4">
                    <div>
                        <label for="author_info" class="block text-sm font-medium text-gray-700 mb-2">
                            Your Information
                        </label>
                        <textarea id="author_info" name="author_info" rows="4" 
                                  class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                  placeholder="Enter basic information about yourself: your background, experience, qualifications, achievements, education, current role, expertise areas, etc."></textarea>
                        <p class="mt-2 text-sm text-gray-600">
                            Enter your basic information and the AI will create a professional author biography
                        </p>
                    </div>
                    
                    <div class="grid md:grid-cols-2 gap-4">
                        <div>
                            <label for="bio_style" class="block text-sm font-medium text-gray-700 mb-2">
                                Bio Style
                            </label>
                            <select id="bio_style" name="bio_style" 
                                    class="w-full px-3 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                                <option value="professional">Professional & Formal</option>
                                <option value="conversational">Conversational & Engaging</option>
                                <option value="academic">Academic & Scholarly</option>
                                <option value="creative">Creative & Expressive</option>
                            </select>
                        </div>
                        
                        <div>
                            <label for="bio_length" class="block text-sm font-medium text-gray-700 mb-2">
                                Bio Length
                            </label>
                            <select id="bio_length" name="bio_length" 
                                    class="w-full px-3 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                                <option value="short">Short (2-3 sentences)</option>
                                <option value="medium">Medium (1 paragraph)</option>
                                <option value="long">Long (2-3 paragraphs)</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="flex justify-center">
                        <button type="button" id="enhance-bio-btn" onclick="enhanceAuthorBio()" 
                                class="bg-gradient-to-r from-purple-500 to-blue-600 text-white px-6 py-3 rounded-lg hover:from-purple-600 hover:to-blue-700 transition-all duration-300 flex items-center space-x-2">
                            <i data-feather="sparkles" class="w-5 h-5"></i>
                            <span>Enhance with AI</span>
                        </button>
                    </div>
                    
                    <div id="enhanced-bio-result" class="hidden">
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Enhanced Author Bio
                        </label>
                        <div class="bg-white border border-gray-300 rounded-lg p-4">
                            <div id="enhanced-bio-content" class="text-gray-900"></div>
                            <div class="mt-4 flex space-x-3">
                                <button type="button" onclick="copyToClipboard('enhanced-bio-content')" 
                                        class="text-sm bg-gray-100 text-gray-700 px-3 py-2 rounded hover:bg-gray-200 transition-colors">
                                    <i data-feather="copy" class="w-4 h-4 inline mr-1"></i>
                                    Copy
                                </button>
                                <button type="button" onclick="useEnhancedBio()" 
                                        class="text-sm bg-blue-500 text-white px-3 py-2 rounded hover:bg-blue-600 transition-colors">
                                    <i data-feather="check" class="w-4 h-4 inline mr-1"></i>
                                    Use This Bio
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Default Author Bio Settings -->
        <div class="border-t border-gray-200 pt-8 mt-8">
            <h2 class="text-2xl font-semibold text-gray-900 mb-6">Default Author Bio</h2>
            
            <form method="POST" action="{{ url_for('save_author_bio') }}" class="bg-gradient-to-br from-green-50 to-emerald-50 border border-green-200 rounded-xl p-6">
                <div class="flex items-start space-x-4 mb-4">
                    <div class="w-10 h-10 bg-gradient-to-br from-green-500 to-emerald-600 rounded-full flex items-center justify-center">
                        <i data-feather="bookmark" class="w-5 h-5 text-white"></i>
                    </div>
                    <div>
                        <h3 class="text-lg font-semibold text-gray-900">Permanent Author Bio</h3>
                        <p class="text-gray-600">Set a default author biography that will be automatically used in all your books</p>
                    </div>
                </div>
                
                <div class="space-y-4">
                    <div>
                        <label for="default_author_name" class="block text-sm font-medium text-gray-700 mb-2">
                            Author Name
                        </label>
                        <input type="text" id="default_author_name" name="default_author_name" 
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"
                               placeholder="Enter your name as it will appear on book covers..."
                               value="{{ config.default_author_name if config.default_author_name else '' }}">
                        <p class="mt-2 text-sm text-gray-600">
                            This name will appear on all your book covers and exports.
                        </p>
                    </div>
                    
                    <div>
                        <label for="default_author_bio" class="block text-sm font-medium text-gray-700 mb-2">
                            Default Author Bio
                        </label>
                        <textarea id="default_author_bio" name="default_author_bio" rows="4" 
                                  class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"
                                  placeholder="Enter your default author biography that will be used across all books...">{{ config.default_author_bio if config.default_author_bio else '' }}</textarea>
                        <p class="mt-2 text-sm text-gray-600">
                            This bio will automatically appear at the end of all your books. You can still modify it for individual books.
                        </p>
                    </div>
                    
                    <div class="flex items-center space-x-4">
                        <label class="flex items-center">
                            <input type="checkbox" name="use_default_bio" value="true" 
                                   {{ 'checked' if config.use_default_bio else '' }}
                                   class="mr-2 rounded border-gray-300 text-green-600 focus:ring-green-500">
                            <span class="text-sm text-gray-700">Automatically use this bio in all new books</span>
                        </label>
                    </div>
                    
                    <div class="bg-white border border-green-200 rounded-lg p-4">
                        <h4 class="text-sm font-semibold text-gray-800 mb-2">Quick Actions</h4>
                        <div class="flex flex-wrap gap-2">
                            <button type="button" onclick="loadEnhancedBioToDefault()" 
                                    class="text-xs bg-purple-100 text-purple-700 px-3 py-1 rounded hover:bg-purple-200 transition-colors">
                                <i data-feather="copy" class="w-3 h-3 inline mr-1"></i>
                                Use Enhanced Bio Above
                            </button>
                            <button type="button" onclick="clearDefaultBio()" 
                                    class="text-xs bg-gray-100 text-gray-700 px-3 py-1 rounded hover:bg-gray-200 transition-colors">
                                <i data-feather="x" class="w-3 h-3 inline mr-1"></i>
                                Clear Bio
                            </button>
                            <button type="button" onclick="previewDefaultBio()" 
                                    class="text-xs bg-blue-100 text-blue-700 px-3 py-1 rounded hover:bg-blue-200 transition-colors">
                                <i data-feather="eye" class="w-3 h-3 inline mr-1"></i>
                                Preview
                            </button>
                        </div>
                    </div>
                    
                    <div class="flex justify-end">
                        <button type="submit" 
                                class="bg-gradient-to-r from-green-600 to-emerald-600 text-white px-6 py-3 rounded-lg hover:from-green-700 hover:to-emerald-700 transition-all duration-200 font-medium">
                            <i data-feather="save" class="w-5 h-5 inline mr-2"></i>
                            Save Author Information
                        </button>
                    </div>
                </div>
            </form>
        </div>
        
        <!-- License Information -->
        <div class="border-t border-gray-200 pt-8">
            <h2 class="text-2xl font-semibold text-gray-900 mb-6">License Information</h2>
            
            <div class="bg-green-50 border border-green-200 rounded-lg p-6">
                <div class="flex items-center mb-4">
                    <div class="w-10 h-10 bg-green-500 rounded-full flex items-center justify-center mr-4">
                        <i data-feather="check" class="w-6 h-6 text-white"></i>
                    </div>
                    <div>
                        <h3 class="text-lg font-semibold text-green-900">License Active</h3>
                        <p class="text-green-700">Your BookGenPro license is active and valid</p>
                    </div>
                </div>
                
                <div class="grid md:grid-cols-2 gap-4 text-sm">
                    <div>
                        <span class="font-medium text-green-900">License Type:</span>
                        <span class="text-green-700 ml-2">{{ config.license_info.license_type if config.license_info else 'Standard' }}</span>
                    </div>
                    <div>
                        <span class="font-medium text-green-900">Email:</span>
                        <span class="text-green-700 ml-2">{{ config.email }}</span>
                    </div>
                    <div>
                        <span class="font-medium text-green-900">Machine ID:</span>
                        <span class="text-green-700 ml-2 font-mono text-xs">{{ config.machine_id }}</span>
                    </div>
                    {% if config.license_info and config.license_info.expires_at %}
                    <div class="col-span-2">
                        <div class="flex items-center justify-between">
                            <span class="font-medium text-green-900">License Expires:</span>
                            <span class="text-green-700">{{ config.license_info.expires_at }}</span>
                        </div>
                        <!-- Countdown Timer -->
                        <div class="mt-3 p-4 bg-green-100 rounded-lg">
                            <div class="text-center">
                                <div class="text-sm text-green-800 mb-2">Time Remaining:</div>
                                <div id="license-countdown" class="font-mono text-2xl font-bold text-green-900" 
                                     data-expires="{{ config.license_info.expires_at }}">
                                    Loading...
                                </div>
                                <div class="text-xs text-green-700 mt-2">
                                    Days : Hours : Minutes : Seconds
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
        
        <!-- API Usage Guidelines -->
        <div class="border-t border-gray-200 pt-8 mt-8">
            <h2 class="text-2xl font-semibold text-gray-900 mb-6">AI Provider Setup & Usage Guidelines</h2>
            
            <div class="grid lg:grid-cols-2 gap-8">
                <!-- OpenRouter Setup -->
                <div class="bg-gradient-to-br from-blue-50 to-indigo-50 border border-blue-200 rounded-xl p-6 shadow-sm">
                    <div class="flex items-center mb-4">
                        <div class="w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center mr-3">
                            <i data-feather="layers" class="w-6 h-6 text-white"></i>
                        </div>
                        <h3 class="text-xl font-semibold text-blue-900">OpenRouter Setup</h3>
                    </div>
                    
                    <div class="space-y-4">
                        <div class="bg-white/70 rounded-lg p-4">
                            <h4 class="font-medium text-blue-900 mb-2">Getting Started</h4>
                            <ol class="text-sm text-blue-800 space-y-2">
                                <li class="flex items-start">
                                    <span class="flex-shrink-0 w-6 h-6 bg-blue-200 rounded-full flex items-center justify-center text-xs font-bold mr-3 mt-0.5">1</span>
                                    Visit <a href="https://openrouter.ai" target="_blank" class="text-blue-600 hover:underline font-medium">OpenRouter.ai</a> and create account
                                </li>
                                <li class="flex items-start">
                                    <span class="flex-shrink-0 w-6 h-6 bg-blue-200 rounded-full flex items-center justify-center text-xs font-bold mr-3 mt-0.5">2</span>
                                    Add credits to your account (minimum $5 recommended)
                                </li>
                                <li class="flex items-start">
                                    <span class="flex-shrink-0 w-6 h-6 bg-blue-200 rounded-full flex items-center justify-center text-xs font-bold mr-3 mt-0.5">3</span>
                                    Generate API key from Keys section
                                </li>
                                <li class="flex items-start">
                                    <span class="flex-shrink-0 w-6 h-6 bg-blue-200 rounded-full flex items-center justify-center text-xs font-bold mr-3 mt-0.5">4</span>
                                    Paste API key in the field above and save
                                </li>
                            </ol>
                        </div>
                        
                        <div class="bg-white/70 rounded-lg p-4">
                            <h4 class="font-medium text-blue-900 mb-2">Best Models for Books</h4>
                            <ul class="text-sm text-blue-800 space-y-2">
                                <li class="flex items-center">
                                    <i data-feather="gift" class="w-4 h-4 mr-2 text-green-600"></i>
                                    <span class="font-medium">Free:</span> Llama 3.2 3B Instruct (great quality, no cost)
                                </li>
                                <li class="flex items-center">
                                    <i data-feather="zap" class="w-4 h-4 mr-2 text-blue-600"></i>
                                    <span class="font-medium">Budget:</span> GPT-3.5 Turbo ($0.001-0.002/1K tokens)
                                </li>
                                <li class="flex items-center">
                                    <i data-feather="star" class="w-4 h-4 mr-2 text-purple-600"></i>
                                    <span class="font-medium">Premium:</span> GPT-4 or Claude 3 Opus (best quality)
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <!-- Google Gemini Setup -->
                <div class="bg-gradient-to-br from-emerald-50 to-teal-50 border border-emerald-200 rounded-xl p-6 shadow-sm">
                    <div class="flex items-center mb-4">
                        <div class="w-10 h-10 bg-emerald-600 rounded-lg flex items-center justify-center mr-3">
                            <i data-feather="cpu" class="w-6 h-6 text-white"></i>
                        </div>
                        <h3 class="text-xl font-semibold text-emerald-900">Google Gemini Setup</h3>
                    </div>
                    
                    <div class="space-y-4">
                        <div class="bg-white/70 rounded-lg p-4">
                            <h4 class="font-medium text-emerald-900 mb-2">Getting Started</h4>
                            <ol class="text-sm text-emerald-800 space-y-2">
                                <li class="flex items-start">
                                    <span class="flex-shrink-0 w-6 h-6 bg-emerald-200 rounded-full flex items-center justify-center text-xs font-bold mr-3 mt-0.5">1</span>
                                    Visit <a href="https://makersuite.google.com/app/apikey" target="_blank" class="text-emerald-600 hover:underline font-medium">Google AI Studio</a>
                                </li>
                                <li class="flex items-start">
                                    <span class="flex-shrink-0 w-6 h-6 bg-emerald-200 rounded-full flex items-center justify-center text-xs font-bold mr-3 mt-0.5">2</span>
                                    Sign in with Google account
                                </li>
                                <li class="flex items-start">
                                    <span class="flex-shrink-0 w-6 h-6 bg-emerald-200 rounded-full flex items-center justify-center text-xs font-bold mr-3 mt-0.5">3</span>
                                    Create new API key for your project
                                </li>
                                <li class="flex items-start">
                                    <span class="flex-shrink-0 w-6 h-6 bg-emerald-200 rounded-full flex items-center justify-center text-xs font-bold mr-3 mt-0.5">4</span>
                                    Copy API key and paste in settings above
                                </li>
                            </ol>
                        </div>
                        
                        <div class="bg-white/70 rounded-lg p-4">
                            <h4 class="font-medium text-emerald-900 mb-2">Gemini Models</h4>
                            <ul class="text-sm text-emerald-800 space-y-2">
                                <li class="flex items-center">
                                    <i data-feather="zap" class="w-4 h-4 mr-2 text-emerald-600"></i>
                                    <span class="font-medium">Gemini 1.5 Flash:</span> Fast, efficient (recommended)
                                </li>
                                <li class="flex items-center">
                                    <i data-feather="star" class="w-4 h-4 mr-2 text-emerald-600"></i>
                                    <span class="font-medium">Gemini 1.5 Pro:</span> Higher quality, slower
                                </li>
                                <li class="flex items-center">
                                    <i data-feather="gift" class="w-4 h-4 mr-2 text-green-600"></i>
                                    <span class="font-medium">Free tier:</span> 15 requests/minute limit
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Usage Tips -->
            <div class="mt-8 bg-gradient-to-r from-amber-50 to-orange-50 border border-amber-200 rounded-xl p-6">
                <h3 class="text-lg font-semibold text-amber-900 mb-4 flex items-center">
                    <i data-feather="lightbulb" class="w-5 h-5 mr-2"></i>
                    Pro Tips for Better Results
                </h3>
                <div class="grid md:grid-cols-2 gap-6">
                    <div>
                        <h4 class="font-medium text-amber-900 mb-2">Cost Management</h4>
                        <ul class="text-sm text-amber-800 space-y-1">
                            <li class="flex items-start">
                                <i data-feather="check" class="w-3 h-3 mr-2 mt-1 text-green-600"></i>
                                Start with free models for testing
                            </li>
                            <li class="flex items-start">
                                <i data-feather="check" class="w-3 h-3 mr-2 mt-1 text-green-600"></i>
                                Monitor usage on provider dashboards
                            </li>
                            <li class="flex items-start">
                                <i data-feather="check" class="w-3 h-3 mr-2 mt-1 text-green-600"></i>
                                Set spending alerts and limits
                            </li>
                        </ul>
                    </div>
                    <div>
                        <h4 class="font-medium text-amber-900 mb-2">Quality Tips</h4>
                        <ul class="text-sm text-amber-800 space-y-1">
                            <li class="flex items-start">
                                <i data-feather="check" class="w-3 h-3 mr-2 mt-1 text-green-600"></i>
                                Use detailed, specific book topics
                            </li>
                            <li class="flex items-start">
                                <i data-feather="check" class="w-3 h-3 mr-2 mt-1 text-green-600"></i>
                                Include target audience information
                            </li>
                            <li class="flex items-start">
                                <i data-feather="check" class="w-3 h-3 mr-2 mt-1 text-green-600"></i>
                                Review and edit generated content
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- System Information -->
        <div class="border-t border-gray-200 pt-8 mt-8">
            <h2 class="text-2xl font-semibold text-gray-900 mb-6">System Information</h2>
            
            <div class="bg-gray-50 rounded-lg p-6">
                <div class="grid md:grid-cols-3 gap-4 text-sm">
                    <div>
                        <span class="font-medium text-gray-900">Version:</span>
                        <span class="text-gray-700 ml-2">BookGenPro v1.0</span>
                    </div>
                    <div>
                        <span class="font-medium text-gray-900">Developer:</span>
                        <span class="text-gray-700 ml-2">ECPMind</span>
                    </div>
                    <div>
                        <span class="font-medium text-gray-900">Support:</span>
                        <a href="https://www.ecertifpro.com" target="_blank" class="text-blue-600 hover:text-blue-800 ml-2">www.ecertifpro.com</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function togglePasswordVisibility(inputId) {
    const input = document.getElementById(inputId);
    const iconContainer = input.nextElementSibling;
    const icon = iconContainer ? iconContainer.querySelector('i') : null;
    
    if (!input || !icon) return;
    
    if (input.type === 'password') {
        input.type = 'text';
        icon.setAttribute('data-feather', 'eye-off');
    } else {
        input.type = 'password';
        icon.setAttribute('data-feather', 'eye');
    }
    
    feather.replace();
}

function toggleProviderSettings() {
    const providerSelect = document.getElementById('ai_provider');
    const openrouterSettings = document.getElementById('openrouter-settings');
    const geminiSettings = document.getElementById('gemini-settings');
    
    if (!providerSelect || !openrouterSettings || !geminiSettings) return;
    
    const provider = providerSelect.value;
    
    if (provider === 'gemini') {
        openrouterSettings.style.display = 'none';
        geminiSettings.style.display = 'block';
    } else {
        openrouterSettings.style.display = 'block';
        geminiSettings.style.display = 'none';
    }
}

// Initialize provider settings on page load
document.addEventListener('DOMContentLoaded', function() {
    toggleProviderSettings();
    initializeLicenseCountdown();
});

// License countdown timer
function initializeLicenseCountdown() {
    const countdownElement = document.getElementById('license-countdown');
    if (!countdownElement) return;
    
    const expiresAt = countdownElement.getAttribute('data-expires');
    if (!expiresAt) return;
    
    function updateCountdown() {
        const now = new Date().getTime();
        const expireTime = new Date(expiresAt).getTime();
        const timeLeft = expireTime - now;
        
        if (timeLeft > 0) {
            const days = Math.floor(timeLeft / (1000 * 60 * 60 * 24));
            const hours = Math.floor((timeLeft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);
            
            countdownElement.innerHTML = `${String(days).padStart(3, '0')} : ${String(hours).padStart(2, '0')} : ${String(minutes).padStart(2, '0')} : ${String(seconds).padStart(2, '0')}`;
            
            // Change color based on time remaining
            const countdownContainer = countdownElement.parentElement.parentElement;
            if (days <= 7) {
                countdownElement.className = 'font-mono text-2xl font-bold text-red-700';
                countdownContainer.className = 'mt-3 p-4 bg-red-100 border border-red-200 rounded-lg';
            } else if (days <= 30) {
                countdownElement.className = 'font-mono text-2xl font-bold text-yellow-700';
                countdownContainer.className = 'mt-3 p-4 bg-yellow-100 border border-yellow-200 rounded-lg';
            } else {
                countdownElement.className = 'font-mono text-2xl font-bold text-green-900';
                countdownContainer.className = 'mt-3 p-4 bg-green-100 rounded-lg';
            }
        } else {
            countdownElement.innerHTML = 'EXPIRED';
            countdownElement.className = 'font-mono text-2xl font-bold text-red-700';
            const countdownContainer = countdownElement.parentElement.parentElement;
            countdownContainer.className = 'mt-3 p-4 bg-red-100 border-2 border-red-300 rounded-lg';
            
            // Update the license status to show expired
            const licenseHeader = document.querySelector('.text-lg.font-semibold.text-green-900');
            const licenseSubtext = document.querySelector('.text-green-700');
            if (licenseHeader) {
                licenseHeader.textContent = 'License Expired';
                licenseHeader.className = 'text-lg font-semibold text-red-900';
            }
            if (licenseSubtext) {
                licenseSubtext.textContent = 'Your BookGenPro license has expired. Please renew to continue using the software.';
                licenseSubtext.className = 'text-red-700';
            }
        }
    }
    
    // Update immediately, then every second
    updateCountdown();
    setInterval(updateCountdown, 1000);
}

// AI Author Bio Enhancement Functions
async function enhanceAuthorBio() {
    const authorInfo = document.getElementById('author_info').value.trim();
    const bioStyle = document.getElementById('bio_style').value;
    const bioLength = document.getElementById('bio_length').value;
    const enhanceBtn = document.getElementById('enhance-bio-btn');
    const resultDiv = document.getElementById('enhanced-bio-result');
    const contentDiv = document.getElementById('enhanced-bio-content');

    if (!authorInfo) {
        alert('Please enter your information first');
        return;
    }

    // Show loading state
    enhanceBtn.innerHTML = '<i data-feather="loader" class="w-5 h-5 animate-spin"></i><span>Generating...</span>';
    enhanceBtn.disabled = true;

    try {
        const response = await fetch('/api/enhance_author_bio', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                author_info: authorInfo,
                bio_style: bioStyle,
                bio_length: bioLength
            })
        });

        const data = await response.json();

        if (data.success) {
            contentDiv.innerHTML = data.enhanced_bio.replace(/\n/g, '<br>');
            resultDiv.classList.remove('hidden');
        } else {
            alert('Error: ' + data.message);
        }
    } catch (error) {
        alert('Error enhancing bio: ' + error.message);
    } finally {
        // Reset button state
        enhanceBtn.innerHTML = '<i data-feather="sparkles" class="w-5 h-5"></i><span>Enhance with AI</span>';
        enhanceBtn.disabled = false;
        feather.replace();
    }
}

function copyToClipboard(elementId) {
    const element = document.getElementById(elementId);
    const text = element.innerText || element.textContent;
    
    navigator.clipboard.writeText(text).then(function() {
        // Show success feedback
        const btn = event.target.closest('button');
        const originalText = btn.innerHTML;
        btn.innerHTML = '<i data-feather="check" class="w-4 h-4 inline mr-1"></i>Copied!';
        btn.classList.add('bg-green-500', 'text-white');
        btn.classList.remove('bg-gray-100', 'text-gray-700');
        
        setTimeout(() => {
            btn.innerHTML = originalText;
            btn.classList.remove('bg-green-500', 'text-white');
            btn.classList.add('bg-gray-100', 'text-gray-700');
            feather.replace();
        }, 2000);
    }).catch(function() {
        alert('Failed to copy to clipboard');
    });
}

function useEnhancedBio() {
    const enhancedBio = document.getElementById('enhanced-bio-content').innerText || document.getElementById('enhanced-bio-content').textContent;
    
    // Store in sessionStorage to use in new project creation
    sessionStorage.setItem('enhanced_author_bio', enhancedBio);
    
    // Show success message
    const btn = event.target;
    const originalText = btn.innerHTML;
    btn.innerHTML = '<i data-feather="check" class="w-4 h-4 inline mr-1"></i>Bio Saved!';
    btn.classList.add('bg-green-500');
    btn.classList.remove('bg-blue-500');
    
    setTimeout(() => {
        btn.innerHTML = originalText;
        btn.classList.remove('bg-green-500');
        btn.classList.add('bg-blue-500');
        feather.replace();
    }, 2000);
    
    // Optionally redirect to home page
    setTimeout(() => {
        window.location.href = '/';
    }, 2500);
}

// Default Bio Management Functions
function loadEnhancedBioToDefault() {
    const enhancedBio = document.getElementById('enhanced-bio-content');
    const defaultBioField = document.getElementById('default_author_bio');
    
    if (enhancedBio && enhancedBio.textContent && defaultBioField) {
        defaultBioField.value = enhancedBio.textContent.trim();
        alert('Enhanced bio loaded to default!');
    } else {
        alert('No enhanced bio available. Generate one first.');
    }
}

function clearDefaultBio() {
    const defaultBioField = document.getElementById('default_author_bio');
    if (defaultBioField) {
        if (confirm('Are you sure you want to clear the default author bio?')) {
            defaultBioField.value = '';
            alert('Default bio cleared.');
        }
    }
}

function previewDefaultBio() {
    const defaultBio = document.getElementById('default_author_bio').value;
    if (!defaultBio.trim()) {
        alert('No default bio to preview.');
        return;
    }
    
    // Create modal to show preview
    const modal = document.createElement('div');
    modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
    modal.innerHTML = `
        <div class="bg-white rounded-lg p-6 max-w-2xl w-full mx-4 max-h-96 overflow-y-auto">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-bold text-gray-900">Author Bio Preview</h3>
                <button onclick="this.closest('.fixed').remove()" class="text-gray-500 hover:text-gray-700">
                    <i data-feather="x" class="w-5 h-5"></i>
                </button>
            </div>
            <div class="prose max-w-none">
                <p class="text-gray-700 leading-relaxed">${defaultBio}</p>
            </div>
            <div class="mt-4 flex justify-end">
                <button onclick="this.closest('.fixed').remove()" 
                        class="px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600 transition-colors">
                    Close
                </button>
            </div>
        </div>
    `;
    
    document.body.appendChild(modal);
    feather.replace();
}
</script>
{% endblock %}
