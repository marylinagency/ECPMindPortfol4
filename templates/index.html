{% extends "base.html" %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
    {% if show_license %}
        <!-- License Activation Section -->
        <div class="min-h-screen flex items-center justify-center">
            <div class="max-w-md w-full">
                <div class="bg-white rounded-xl shadow-2xl p-8 glass-morphism fade-in">
                    <div class="text-center mb-8">
                        <div class="w-16 h-16 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center mx-auto mb-4 pulse-glow">
                            <i data-feather="key" class="w-8 h-8 text-white"></i>
                        </div>
                        <h2 class="text-2xl font-bold text-gray-900 mb-2">Activate BookGenPro</h2>
                        <p class="text-gray-600">Enter your license key to get started</p>
                    </div>
                    
                    <form method="POST" action="{{ url_for('activate_license') }}" data-validate>
                        <div class="space-y-6">
                            <div>
                                <label for="license_key" class="block text-sm font-medium text-gray-700 mb-2">License Key</label>
                                <input type="text" id="license_key" name="license_key" required
                                       class="w-full px-3 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
                                       placeholder="Enter your license key">
                            </div>
                            
                            <div>
                                <label for="email" class="block text-sm font-medium text-gray-700 mb-2">Email Address</label>
                                <input type="email" id="email" name="email" required
                                       class="w-full px-3 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
                                       placeholder="Enter your email address">
                            </div>
                            
                            <div class="bg-gray-50 border border-gray-200 rounded-lg p-3">
                                <div class="flex items-center text-sm text-gray-600">
                                    <i data-feather="shield" class="w-4 h-4 mr-2"></i>
                                    <span>Machine ID: <span class="font-mono text-xs">{{ config.machine_id }}</span></span>
                                </div>
                                <p class="text-xs text-gray-500 mt-1">Automatically generated for this device</p>
                            </div>
                            
                            <button type="submit" 
                                    class="w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white py-3 rounded-lg hover:shadow-lg transform hover:scale-105 transition-all duration-200 font-medium">
                                <i data-feather="unlock" class="w-5 h-5 inline mr-2"></i>
                                Activate License
                            </button>
                        </div>
                    </form>
                    
                    <div class="mt-8 pt-6 border-t border-gray-200 text-center">
                        <p class="text-sm text-gray-600">
                            Need a license? Visit 
                            <a href="https://www.ecertifpro.com" target="_blank" class="text-blue-600 hover:text-blue-800 font-medium">ECertifPro.com</a>
                        </p>
                    </div>
                </div>
            </div>
        </div>
    {% else %}
        <!-- Main Dashboard -->
        <div class="fade-in">
            <!-- Hero Section -->
            <div class="text-center mb-12 scroll-reveal">
                <h1 class="text-4xl md:text-6xl font-bold text-shimmer mb-4" data-typing>
                    BookGenPro
                </h1>
                <p class="text-xl text-gray-600 mb-8 max-w-3xl mx-auto scroll-reveal">
                    Transform your ideas into complete books with AI-powered chapter generation, 
                    professional styling, and seamless export capabilities.
                </p>
            </div>
            
            <!-- Quick Actions -->
            <div class="grid md:grid-cols-2 gap-8 mb-12">
                <!-- Create New Project -->
                <div class="bg-white rounded-xl shadow-lg p-8 card-interactive scroll-reveal">
                    <div class="flex items-center mb-6">
                        <div class="w-12 h-12 bg-gradient-to-br from-green-500 to-blue-600 rounded-lg flex items-center justify-center mr-4">
                            <i data-feather="plus-circle" class="w-6 h-6 text-white"></i>
                        </div>
                        <h3 class="text-2xl font-bold text-gray-900">Create New Book</h3>
                    </div>
                    
                    <form method="POST" action="{{ url_for('create_project') }}" enctype="multipart/form-data" id="new-project-form" data-validate>
                        <div class="space-y-4">
                            <div>
                                <label for="project_name" class="block text-sm font-medium text-gray-700 mb-2">Project Name</label>
                                <input type="text" id="project_name" name="project_name" required
                                       class="w-full px-3 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                       placeholder="Enter project name">
                            </div>
                            
                            <div>
                                <label for="book_topic" class="block text-sm font-medium text-gray-700 mb-2">Book Topic/Theme</label>
                                <textarea id="book_topic" name="book_topic" rows="3" required
                                          class="w-full px-3 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                          placeholder="Describe your book topic, genre, and main themes..."></textarea>
                            </div>
                            
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label for="language" class="block text-sm font-medium text-gray-700 mb-2">Language</label>
                                    <select id="language" name="language" class="w-full px-3 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                        <option value="English">English</option>
                                        <option value="Spanish">Spanish</option>
                                        <option value="French">French</option>
                                        <option value="German">German</option>
                                        <option value="Italian">Italian</option>
                                        <option value="Portuguese">Portuguese</option>
                                        <option value="Arabic">Arabic</option>
                                        <option value="Chinese">Chinese</option>
                                        <option value="Japanese">Japanese</option>
                                    </select>
                                </div>
                                
                                <div>
                                    <label for="num_chapters" class="block text-sm font-medium text-gray-700 mb-2">Number of Chapters</label>
                                    <input type="number" id="num_chapters" name="num_chapters" value="10" min="3" max="50"
                                           class="w-full px-3 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                </div>
                            </div>
                            
                            <div>
                                <label for="cover_image" class="block text-sm font-medium text-gray-700 mb-2">Cover Image (Optional)</label>
                                <input type="file" id="cover_image" name="cover_image" accept="image/*"
                                       class="w-full px-3 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                       onchange="handleFileUpload(this)">
                                <div id="cover-preview" class="mt-2 w-20 h-28 border-2 border-dashed border-gray-300 rounded-lg hidden"></div>
                            </div>
                            
                            <button type="submit" 
                                    class="w-full btn-dynamic text-white py-3 rounded-lg font-medium">
                                <i data-feather="book-open" class="w-5 h-5 inline mr-2"></i>
                                Create Book Project
                            </button>
                        </div>
                    </form>
                </div>
                
                <!-- AI Book Generation -->
                <div class="bg-white rounded-xl shadow-lg p-8 card-interactive scroll-reveal">
                    <div class="flex items-center mb-6">
                        <div class="w-12 h-12 bg-gradient-to-br from-orange-500 to-red-600 rounded-lg flex items-center justify-center mr-4">
                            <i data-feather="zap" class="w-6 h-6 text-white"></i>
                        </div>
                        <h3 class="text-2xl font-bold text-gray-900">AI Book Generation</h3>
                    </div>
                    
                    <form method="POST" action="{{ url_for('generate_book') }}" class="space-y-4" id="generate-book-form">
                        <div>
                            <label for="gen_topic" class="block text-sm font-medium text-gray-700 mb-2">Book Topic/Theme</label>
                            <textarea id="gen_topic" name="topic" rows="3" required
                                      class="w-full px-3 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent"
                                      placeholder="Describe your book topic, genre, target audience, and key themes you want covered..."></textarea>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label for="gen_language" class="block text-sm font-medium text-gray-700 mb-2">Language</label>
                                <select id="gen_language" name="language" class="w-full px-3 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500">
                                    <option value="English">English</option>
                                    <option value="Spanish">Spanish</option>
                                    <option value="French">French</option>
                                    <option value="German">German</option>
                                    <option value="Italian">Italian</option>
                                    <option value="Portuguese">Portuguese</option>
                                    <option value="Arabic">Arabic</option>
                                    <option value="Chinese">Chinese</option>
                                    <option value="Japanese">Japanese</option>
                                </select>
                            </div>
                            
                            <div>
                                <label for="gen_chapters" class="block text-sm font-medium text-gray-700 mb-2">Chapters</label>
                                <input type="number" id="gen_chapters" name="chapters" value="8" min="3" max="25"
                                       class="w-full px-3 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent">
                            </div>
                            
                            <div>
                                <label for="gen_style" class="block text-sm font-medium text-gray-700 mb-2">Writing Style</label>
                                <select id="gen_style" name="style" class="w-full px-3 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500">
                                    <option value="professional">Professional</option>
                                    <option value="casual">Casual</option>
                                    <option value="academic">Academic</option>
                                    <option value="creative">Creative</option>
                                    <option value="technical">Technical</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="bg-gradient-to-r from-orange-50 to-red-50 border border-orange-200 rounded-lg p-4">
                            <div class="flex items-start space-x-3">
                                <i data-feather="info" class="w-5 h-5 text-orange-600 mt-0.5"></i>
                                <div>
                                    <h4 class="font-medium text-orange-900 mb-1">AI Generation Process</h4>
                                    <ul class="text-sm text-orange-800 space-y-1">
                                        <li>• Chapter titles will be generated first based on your topic</li>
                                        <li>• Content will be created chapter by chapter automatically</li>
                                        <li>• You can monitor progress and edit content as needed</li>
                                        <li>• Generation typically takes 2-5 minutes per chapter</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        
                        <div class="flex space-x-4">
                            <button type="submit" name="action" value="generate_titles"
                                    class="flex-1 bg-gradient-to-r from-orange-600 to-red-600 btn-dynamic text-white py-3 rounded-lg font-medium">
                                <i data-feather="list" class="w-5 h-5 inline mr-2"></i>
                                Generate Chapter Titles Only
                            </button>
                            
                            <button type="submit" name="action" value="generate_full"
                                    class="flex-1 bg-gradient-to-r from-red-600 to-pink-600 btn-dynamic text-white py-3 rounded-lg font-medium">
                                <i data-feather="book" class="w-5 h-5 inline mr-2"></i>
                                Generate Full Book
                            </button>
                        </div>
                    </form>
                    
                    <!-- Generation Status -->
                    <div id="generation-status" class="mt-6 hidden">
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                            <div class="flex items-center justify-between mb-3">
                                <h4 class="font-medium text-blue-900">Generation Progress</h4>
                                <span id="progress-text" class="text-sm text-blue-700">Initializing...</span>
                            </div>
                            
                            <div class="w-full bg-blue-200 rounded-full h-2 mb-3">
                                <div id="progress-bar" class="progress-animated h-2 rounded-full" style="width: 0%"></div>
                            </div>
                            
                            <div id="current-chapter" class="text-sm text-blue-600"></div>
                        </div>
                        
                        <div class="mt-4 flex justify-center">
                            <button onclick="stopGeneration()" class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-colors">
                                <i data-feather="stop-circle" class="w-4 h-4 inline mr-2"></i>
                                Stop Generation
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Quick Generation Templates -->
            <div class="mb-12 card-interactive scroll-reveal">
                <h2 class="text-3xl font-bold text-gray-900 mb-8 text-center">Quick Start Templates</h2>
                <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-6">
                    <div class="bg-white rounded-lg shadow-lg p-6 hover:shadow-xl transition-all duration-300 cursor-pointer" onclick="fillTemplate('business')">
                        <div class="w-12 h-12 bg-gradient-to-br from-blue-500 to-purple-600 rounded-lg flex items-center justify-center mb-4">
                            <i data-feather="briefcase" class="w-6 h-6 text-white"></i>
                        </div>
                        <h3 class="text-lg font-bold text-gray-900 mb-2">Business Guide</h3>
                        <p class="text-sm text-gray-600">Entrepreneurship, marketing, and business strategy</p>
                    </div>
                    
                    <div class="bg-white rounded-lg shadow-lg p-6 hover:shadow-xl transition-all duration-300 cursor-pointer" onclick="fillTemplate('tech')">
                        <div class="w-12 h-12 bg-gradient-to-br from-green-500 to-teal-600 rounded-lg flex items-center justify-center mb-4">
                            <i data-feather="code" class="w-6 h-6 text-white"></i>
                        </div>
                        <h3 class="text-lg font-bold text-gray-900 mb-2">Tech Tutorial</h3>
                        <p class="text-sm text-gray-600">Programming, software development, and technology</p>
                    </div>
                    
                    <div class="bg-white rounded-lg shadow-lg p-6 hover:shadow-xl transition-all duration-300 cursor-pointer" onclick="fillTemplate('fiction')">
                        <div class="w-12 h-12 bg-gradient-to-br from-purple-500 to-pink-600 rounded-lg flex items-center justify-center mb-4">
                            <i data-feather="feather" class="w-6 h-6 text-white"></i>
                        </div>
                        <h3 class="text-lg font-bold text-gray-900 mb-2">Fiction Story</h3>
                        <p class="text-sm text-gray-600">Creative writing, novels, and storytelling</p>
                    </div>
                    
                    <div class="bg-white rounded-lg shadow-lg p-6 hover:shadow-xl transition-all duration-300 cursor-pointer" onclick="fillTemplate('educational')">
                        <div class="w-12 h-12 bg-gradient-to-br from-orange-500 to-red-600 rounded-lg flex items-center justify-center mb-4">
                            <i data-feather="book-open" class="w-6 h-6 text-white"></i>
                        </div>
                        <h3 class="text-lg font-bold text-gray-900 mb-2">Educational</h3>
                        <p class="text-sm text-gray-600">Learning materials, courses, and tutorials</p>
                    </div>
                </div>
            </div>
            
            <div class="grid md:grid-cols-2 gap-8 mb-12">
                <!-- API Configuration -->
                <div class="bg-white rounded-xl shadow-lg p-8 card-interactive scroll-reveal">
                    <div class="flex items-center mb-6">
                        <div class="w-12 h-12 bg-gradient-to-br from-purple-500 to-pink-600 rounded-lg flex items-center justify-center mr-4">
                            <i data-feather="settings" class="w-6 h-6 text-white"></i>
                        </div>
                        <h3 class="text-2xl font-bold text-gray-900">Configuration</h3>
                    </div>
                    
                    <div class="space-y-4">
                        <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                            <div>
                                <h4 class="font-medium text-gray-900">OpenRouter API</h4>
                                <p class="text-sm text-gray-600">
                                    {% if config.openrouter_api_key %}
                                        <span class="text-green-600">✓ Configured</span>
                                    {% else %}
                                        <span class="text-red-600">✗ Not configured</span>
                                    {% endif %}
                                </p>
                            </div>
                            <a href="{{ url_for('settings') }}" 
                               class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                                Configure
                            </a>
                        </div>
                        
                        <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                            <div>
                                <h4 class="font-medium text-gray-900">Selected Model</h4>
                                <p class="text-sm text-gray-600">{{ config.selected_model or 'Not selected' }}</p>
                            </div>
                            <a href="{{ url_for('settings') }}" 
                               class="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors">
                                Change
                            </a>
                        </div>
                        
                        <div class="mt-6 p-4 bg-blue-50 rounded-lg">
                            <h4 class="font-medium text-blue-900 mb-2">Features Available</h4>
                            <ul class="text-sm text-blue-800 space-y-1">
                                <li class="flex items-center"><i data-feather="check" class="w-4 h-4 mr-2"></i>AI Chapter Generation</li>
                                <li class="flex items-center"><i data-feather="check" class="w-4 h-4 mr-2"></i>Multi-language Support</li>
                                <li class="flex items-center"><i data-feather="check" class="w-4 h-4 mr-2"></i>PDF & HTML Export</li>
                                <li class="flex items-center"><i data-feather="check" class="w-4 h-4 mr-2"></i>Project Management</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Recent Projects -->
            {% if recent_projects %}
            <div class="mb-12">
                <h2 class="text-3xl font-bold text-gray-900 mb-8">Recent Projects</h2>
                <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                    {% for project in recent_projects %}
                    <div class="bg-white rounded-lg shadow-lg overflow-hidden card-interactive scroll-reveal tooltip-dynamic" data-tooltip="Click to open project">
                        {% if project.cover_image %}
                            <div class="h-48 bg-cover bg-center book-cover" 
                                 style="background-image: url('{{ url_for('static', filename='../uploads/' + project.cover_image) }}');">
                            </div>
                        {% else %}
                            <div class="h-48 book-cover flex items-center justify-center">
                                <i data-feather="book" class="w-16 h-16 text-white opacity-80"></i>
                            </div>
                        {% endif %}
                        
                        <div class="p-6">
                            <h3 class="text-xl font-bold text-gray-900 mb-2">{{ project.name }}</h3>
                            <p class="text-gray-600 mb-4 line-clamp-2">{{ project.topic }}</p>
                            
                            <div class="flex items-center justify-between text-sm text-gray-500 mb-4">
                                <span>{{ project.chapters|length }} chapters</span>
                                <span>{{ project.language }}</span>
                            </div>
                            
                            <a href="{{ url_for('project_view', project_id=project.id) }}" 
                               class="w-full btn-dynamic text-white py-2 px-4 rounded-lg text-center block">
                                <i data-feather="arrow-right" class="w-4 h-4 inline mr-2"></i>
                                Open Project
                            </a>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
            
            <!-- About Section -->
            <div class="bg-white rounded-xl shadow-lg p-8 mb-12 card-interactive scroll-reveal">
                <div class="text-center">
                    <h2 class="text-3xl font-bold text-gray-900 mb-6 text-shimmer">About BookGenPro</h2>
                    <div class="max-w-4xl mx-auto">
                        <p class="text-lg text-gray-600 mb-8">
                            BookGenPro is an innovative AI-powered book generation tool that transforms your ideas into 
                            complete, professionally structured books. Using advanced AI technology through OpenRouter API, 
                            it automatically generates compelling chapter titles and rich content based on your book's theme.
                        </p>
                        
                        <div class="grid md:grid-cols-3 gap-8 mb-8">
                            <div class="text-center">
                                <div class="w-16 h-16 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center mx-auto mb-4">
                                    <i data-feather="zap" class="w-8 h-8 text-white"></i>
                                </div>
                                <h3 class="text-xl font-semibold text-gray-900 mb-2">AI-Powered</h3>
                                <p class="text-gray-600">Advanced AI generates chapter titles and content automatically</p>
                            </div>
                            
                            <div class="text-center">
                                <div class="w-16 h-16 bg-gradient-to-br from-green-500 to-blue-600 rounded-full flex items-center justify-center mx-auto mb-4">
                                    <i data-feather="globe" class="w-8 h-8 text-white"></i>
                                </div>
                                <h3 class="text-xl font-semibold text-gray-900 mb-2">Multi-Language</h3>
                                <p class="text-gray-600">Generate books in multiple languages with native fluency</p>
                            </div>
                            
                            <div class="text-center">
                                <div class="w-16 h-16 bg-gradient-to-br from-purple-500 to-pink-600 rounded-full flex items-center justify-center mx-auto mb-4">
                                    <i data-feather="download" class="w-8 h-8 text-white"></i>
                                </div>
                                <h3 class="text-xl font-semibold text-gray-900 mb-2">Professional Export</h3>
                                <p class="text-gray-600">Export to PDF and HTML with beautiful, professional styling</p>
                            </div>
                        </div>
                        
                        <div class="border-t border-gray-200 pt-8">
                            <p class="text-gray-600 mb-4">
                                Developed with passion by the ECPMind team, BookGenPro represents the cutting edge of 
                                AI-assisted content creation, making professional book writing accessible to everyone.
                            </p>
                            <a href="https://www.ecertifpro.com" target="_blank" 
                               class="inline-flex items-center text-blue-600 hover:text-blue-800 font-semibold">
                                <i data-feather="external-link" class="w-4 h-4 mr-2"></i>
                                Learn more at ECertifPro.com
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Floating Action Button -->
        <button class="fab tooltip-dynamic" data-tooltip="Quick actions" onclick="showQuickActions()">
            <i data-feather="plus" class="w-6 h-6"></i>
        </button>
        
        <!-- Dynamic loading overlay -->
        <div id="loading-overlay" class="fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm hidden items-center justify-center z-50">
            <div class="bg-white rounded-lg p-8 text-center">
                <div class="animate-spin w-12 h-12 border-4 border-blue-500 border-t-transparent rounded-full mx-auto mb-4"></div>
                <p class="text-gray-700 font-medium">Processing your request...</p>
            </div>
        </div>
    {% endif %}
</div>

<!-- Real-time notifications container -->
<div id="notifications-container" class="fixed top-4 right-4 z-50 space-y-2"></div>

<!-- Dynamic status bar -->
<div id="status-bar" class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 px-4 py-2 text-sm text-gray-600 hidden">
    <div class="flex items-center justify-between">
        <span id="status-text">Ready</span>
        <div class="flex items-center space-x-4">
            <span id="connection-status" class="status-indicator status-completed">Online</span>
            <button onclick="toggleStatusBar()" class="text-gray-400 hover:text-gray-600">
                <i data-feather="x" class="w-4 h-4"></i>
            </button>
        </div>
    </div>
</div>
{% endblock %}
